{% extends 'base.html' %}
{% load dict_get %}
{% block content %}

<h2>Your Habits</h2>

<!-- Form for adding a habit -->
<form method="post">
    {% csrf_token %}
    <div class="form-row mb-3">
        {{ form.name }}
        <button type="submit" name="add_habit" class="btn btn-primary ml-2">Add Habit</button>
    </div>
</form>

<!-- Form for updating checkboxes -->
<form method="post">
    {% csrf_token %}
    <table class="table table-bordered">
        <thead class="thead-light">
            <tr>
                <th>Habit</th>
                {% for day in days %}
                    <th>{{ day.day }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for habit in habits %}
                <tr>
                    <td>{{ habit.name }}</td>
                    {% for day in days %}
                        <td>
                            {% with habit_status=status|dict_get:habit.id %}
                                {% with date_str=day|date:'Y-m-d' %}
                                    {% with day_status=habit_status|dict_get:date_str %}
                                        <input type="checkbox" name="{{ habit.id }}_{{ date_str }}"
                                               {% if day_status %}checked{% endif %}>
                                    {% endwith %}
                                {% endwith %}
                            {% endwith %}
                        </td>
                    {% endfor %}
                </tr>
            {% empty %}
                <tr><td colspan="{{ days|length|add:'1' }}">No habits yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit" name="update_status" class="btn btn-success">Update Status</button>
</form>

{% endblock %}
